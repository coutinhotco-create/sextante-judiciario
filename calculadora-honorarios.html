<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de honorários advocatícios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* PERPLEXITY DESIGN SYSTEM */
    :root {
      /* Primitive Color Tokens */
      --color-white: rgba(255, 255, 255, 1); --color-black: rgba(0, 0, 0, 1); --color-cream-50: rgba(252, 252, 249, 1); --color-cream-100: rgba(255, 255, 253, 1); --color-gray-200: rgba(245, 245, 245, 1); --color-gray-300: rgba(167, 169, 169, 1); --color-gray-400: rgba(119, 124, 124, 1); --color-slate-500: rgba(98, 108, 113, 1); --color-brown-600: rgba(94, 82, 64, 1); --color-charcoal-700: rgba(31, 33, 33, 1); --color-charcoal-800: rgba(38, 40, 40, 1); --color-slate-900: rgba(19, 52, 59, 1); --color-teal-300: rgba(50, 184, 198, 1); --color-teal-400: rgba(45, 166, 178, 1); --color-teal-500: rgba(33, 128, 141, 1); --color-teal-600: rgba(29, 116, 128, 1); --color-teal-700: rgba(26, 104, 115, 1); --color-teal-800: rgba(41, 150, 161, 1); --color-red-400: rgba(255, 84, 89, 1); --color-red-500: rgba(192, 21, 47, 1); --color-orange-400: rgba(230, 129, 97, 1); --color-orange-500: rgba(168, 75, 47, 1);
      /* RGB versions */
      --color-brown-600-rgb: 94, 82, 64; --color-teal-500-rgb: 33, 128, 141; --color-slate-900-rgb: 19, 52, 59;
      /* Semantic Colors (Light) */
      --color-background: var(--color-cream-50); --color-surface: var(--color-cream-100); --color-text: var(--color-slate-900); --color-text-secondary: var(--color-slate-500); --color-primary: var(--color-teal-500); --color-primary-hover: var(--color-teal-600); --color-border: rgba(var(--color-brown-600-rgb), 0.2); --color-btn-primary-text: var(--color-cream-50); --color-error: var(--color-red-500); --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
      /* Typography */
      --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; --font-size-sm: 12px; --font-size-base: 14px; --font-size-lg: 16px; --font-size-xl: 18px; --font-size-2xl: 20px; --font-size-3xl: 24px; --font-weight-normal: 400; --font-weight-medium: 500; --font-weight-bold: 600;
      /* Spacing */
      --space-4: 4px; --space-8: 8px; --space-12: 12px; --space-16: 16px; --space-20: 20px; --space-24: 24px; --space-32: 32px;
      /* Borders & Shadows */
      --radius-sm: 6px; --radius-base: 8px; --radius-lg: 12px; --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.02); --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.04), 0 2px 4px -1px rgba(0,0,0,0.02);
      /* Transitions */
      --duration-normal: 250ms; --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --color-gray-300-rgb: 167, 169, 169; --color-gray-400-rgb: 119, 124, 124; --color-teal-300-rgb: 50, 184, 198;
        --color-background: var(--color-charcoal-700); --color-surface: var(--color-charcoal-800); --color-text: var(--color-gray-200); --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7); --color-primary: var(--color-teal-300); --color-primary-hover: var(--color-teal-400); --color-border: rgba(var(--color-gray-400-rgb), 0.3); --color-btn-primary-text: var(--color-slate-900); --color-error: var(--color-red-400); --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
      }
    }
    @font-face { font-family: 'FKGroteskNeue'; src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2'); }
    /* BASE & LAYOUT */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: var(--font-family-base); background: var(--color-background); color: var(--color-text); padding: var(--space-20); line-height: 1.6; -webkit-font-smoothing: antialiased; }
    .container { max-width: 900px; margin: 0 auto; background: var(--color-surface); padding: var(--space-32); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); border: 1px solid var(--color-border); }
    .voltar { max-width: 900px; margin: 0 auto var(--space-20); }
    .voltar a { display: inline-flex; align-items: center; gap: var(--space-8); color: var(--color-primary); text-decoration: none; font-size: var(--font-size-base); font-weight: var(--font-weight-medium); transition: opacity var(--duration-normal); }
    .voltar a:hover { opacity: 0.8; }
    /* TYPOGRAPHY */
    h1 { color: var(--color-text); margin-bottom: var(--space-8); font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); }
    h2 { color: var(--color-text); margin-bottom: var(--space-20); font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); text-align: center; }
    h3 { font-size: var(--font-size-xl); color: var(--color-text); margin-bottom: var(--space-16); }
    .subtitle { color: var(--color-text-secondary); margin-bottom: var(--space-32); font-size: var(--font-size-base); }
    /* FORMS */
    .campo { margin-bottom: var(--space-24); }
    label { display: block; margin-bottom: var(--space-8); font-weight: var(--font-weight-medium); color: var(--color-text); font-size: var(--font-size-base); }
    input[type="text"], input[type="number"], input[type="date"], textarea {
      display: block; width: 100%; padding: var(--space-12); font-size: var(--font-size-base); line-height: 1.5; color: var(--color-text); background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-base); transition: border-color var(--duration-normal), box-shadow var(--duration-normal);
    }
    input:focus, input:focus-visible, textarea:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-focus-ring); }
    .input-prefix-container { position: relative; }
    .input-prefix { position: absolute; left: var(--space-12); top: 50%; transform: translateY(-50%); color: var(--color-text-secondary); font-size: var(--font-size-base); pointer-events: none; }
    input.has-prefix { padding-left: var(--space-32); }
    
    .checkbox-group { display: flex; flex-direction: column; gap: var(--space-16); }
    .checkbox-option { border: 1px solid var(--color-border); border-radius: var(--radius-base); padding: var(--space-16); transition: all var(--duration-normal) var(--ease-standard); cursor: pointer; }
    .checkbox-option:hover { border-color: var(--color-primary); background: rgba(var(--color-teal-500-rgb), 0.05); }
    .checkbox-option.active { border-color: var(--color-primary); background: rgba(var(--color-teal-500-rgb), 0.1); box-shadow: 0 0 0 1px var(--color-primary); }
    .checkbox-option input[type="checkbox"] { margin-right: var(--space-12); cursor: pointer; accent-color: var(--color-primary); width: 16px; height: 16px; }
    .checkbox-option > div:first-child { display: flex; align-items: center; }
    .checkbox-option label { margin: 0; cursor: pointer; font-weight: var(--font-weight-medium); color: var(--color-text); }
    .checkbox-option .descricao { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--space-4); margin-left: calc(var(--space-12) + 16px); }
    .percentual-input { margin-top: var(--space-12); margin-left: calc(var(--space-12) + 16px); display: none; }
    .percentual-input.ativo { display: block; }
    .percentual-input input { width: 150px; }
    .erro { color: var(--color-error); font-size: var(--font-size-sm); margin-top: var(--space-8); display: none; }
    .erro.ativo { display: block; }
    /* BUTTONS */
    button { display: inline-flex; align-items: center; justify-content: center; padding: var(--space-12) var(--space-20); border-radius: var(--radius-base); font-size: var(--font-size-lg); font-weight: var(--font-weight-medium); line-height: 1.5; cursor: pointer; transition: all var(--duration-normal) var(--ease-standard); border: none; text-decoration: none; position: relative; width: 100%; margin-top: var(--space-12); }
    button:focus-visible { outline: none; box-shadow: 0 0 0 3px var(--color-focus-ring); }
    #btnCalc, #btnGerarCertidao, .modal-buttons button:last-child { background: var(--color-primary); color: var(--color-btn-primary-text); }
    #btnCalc:hover:not(:disabled), #btnGerarCertidao:hover:not(:disabled), .modal-buttons button:last-child:hover:not(:disabled) { background: var(--color-primary-hover); }
    #btnGerarAlvara, .modal-buttons button.btn-secondary { background-color: var(--color-surface); color: var(--color-text); border: 1px solid var(--color-border); }
    #btnGerarAlvara:hover:not(:disabled), .modal-buttons button.btn-secondary:hover:not(:disabled) { background-color: rgba(var(--color-brown-600-rgb), 0.1); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    /* RESULT & SUMMARY */
    .resumo { background: rgba(var(--color-brown-600-rgb), 0.05); border: 1px solid var(--color-border); padding: var(--space-20); border-radius: var(--radius-base); margin: var(--space-24) 0; display: none; }
    .resumo.ativo { display: block; }
    .resumo-item { margin-bottom: var(--space-8); color: var(--color-text-secondary); }
    .resumo-item strong { color: var(--color-text); }
    .resultado { display: none; margin-top: var(--space-32); }
    .resultado.ativo { display: block; }
    .card-total { grid-column: 1 / -1; background: var(--color-surface); border: 1px solid var(--color-border); color: var(--color-text); text-align: left; padding: var(--space-24); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); }
    .card-total .card-detalhe { font-size: var(--font-size-base); color: var(--color-text-secondary); margin-bottom: var(--space-8); }
    .card-total .card-detalhe strong { color: var(--color-text); }
    /* CERTIDAO SECTION */
    .certidao-section { background: rgba(var(--color-brown-600-rgb), 0.05); border: 1px solid var(--color-border); padding: var(--space-24); border-radius: var(--radius-base); margin-top: var(--space-32); display: none; }
    .certidao-section.ativo { display: block; }
    .certidao-section > h3 { color: var(--color-primary); }
    .certidao-checkbox { display: flex; align-items: center; margin-bottom: var(--space-24); }
    .certidao-checkbox input { margin-right: var(--space-12); width: 18px; height: 18px; cursor: pointer; accent-color: var(--color-primary); }
    .certidao-checkbox label { cursor: pointer; font-weight: var(--font-weight-medium); color: var(--color-text); font-size: var(--font-size-lg); }
    .certidao-campos { display: none; }
    .certidao-campos.ativo { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-16) var(--space-24); }
    .certidao-campos .campo { margin-bottom: 0; }
    @media (max-width: 768px) { .certidao-campos { grid-template-columns: 1fr; } }
    .campo-opcional { font-size: var(--font-size-sm); color: var(--color-text-secondary); font-weight: var(--font-weight-normal); }
    /* MODAL */
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); overflow: auto; backdrop-filter: blur(4px); }
    .modal.ativo { display: flex; align-items: center; justify-content: center; }
    .modal-content { background: var(--color-surface); margin: var(--space-20); max-width: 900px; position: relative; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); border: 1px solid var(--color-border); display: flex; flex-direction: column; max-height: 90vh; }
    .modal-header { padding: var(--space-16) var(--space-24); background: var(--color-primary); color: var(--color-btn-primary-text); display: flex; justify-content: space-between; align-items: center; border-top-left-radius: var(--radius-lg); border-top-right-radius: var(--radius-lg); }
    .modal-header h2 { font-size: var(--font-size-xl); margin: 0; color: var(--color-btn-primary-text); text-align: left; }
    .modal-close { background: transparent; border: none; color: var(--color-btn-primary-text); font-size: 28px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background var(--duration-normal); opacity: 0.8; }
    .modal-close:hover { background: rgba(255,255,255,0.15); opacity: 1; }
    .modal-body { padding: var(--space-32); overflow-y: auto; }
    .modal-buttons { padding: var(--space-16) var(--space-24); background: var(--color-background); display: flex; gap: var(--space-12); justify-content: flex-end; border-top: 1px solid var(--color-border); border-bottom-left-radius: var(--radius-lg); border-bottom-right-radius: var(--radius-lg); }
    .modal-buttons button { width: auto; margin-top: 0; }
    /* CERTIDAO/ALVARA PREVIEW */
    .certidao-preview, .alvara-preview { font-family: 'Times New Roman', serif; line-height: 1.8; color: #000; }
    .certidao-preview h2 { text-align: center; font-size: 18px; margin-bottom: 30px; text-transform: uppercase; color: #000; }
    .certidao-preview .orgao { text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 16px; }
    .certidao-preview .titulo { text-align: center; font-weight: bold; margin: 30px 0 20px; font-size: 16px; }
    .certidao-preview .corpo { text-align: justify; margin-bottom: 15px; font-size: 14px; }
    .certidao-preview table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }
    .certidao-preview table th, .certidao-preview table td { border: 1px solid #000; padding: 8px; text-align: left; }
    .certidao-preview table th { background: #f0f0f0; font-weight: bold; }
    .certidao-preview .assinatura { margin-top: 60px; text-align: center; }
    .certidao-preview .assinatura-linha { border-top: 1px solid #000; width: 300px; margin: 0 auto 10px; }
    .alvara-textarea { 
      width: 100%; 
      min-height: 500px; 
      font-family: 'Times New Roman', serif; 
      font-size: 14px; 
      line-height: 1.8; 
      padding: 20px; 
      border: 1px solid #ccc; 
      border-radius: 4px; 
      resize: vertical; 
      white-space: pre-wrap;
    }
    /* PRINT STYLES - CORRIGIDOS */
    @media print {
      body * {
        visibility: hidden;
      }
      .modal.ativo,
      .modal.ativo * {
        visibility: visible;
      }
      .modal {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: auto;
        background: white;
        display: block !important;
        overflow: visible;
      }
      .modal-content {
        margin: 0;
        max-width: 100%;
        box-shadow: none;
        border: none;
        max-height: none;
        display: block;
      }
      .modal-header,
      .modal-buttons,
      .modal-close {
        display: none !important;
      }
      .modal-body {
        padding: 20mm;
        overflow: visible;
      }
      .certidao-preview, 
      .alvara-preview,
      .alvara-textarea {
        font-size: 12pt;
        color: #000;
        line-height: 1.6;
      }
      .certidao-preview *,
      .alvara-preview * {
        color: #000 !important;
      }
      .alvara-textarea {
        border: none;
        min-height: auto;
        height: auto;
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="voltar">
    <a href="index.html">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      <span>Sextante Judiciário</span>
    </a>
  </div>

  <div class="container">
    <h1>Calculadora de honorários advocatícios</h1>
    <p class="subtitle">Apure valores de honorários contratuais e sucumbenciais de forma simples e precisa.</p>
    
    <div class="campo">
      <label for="valorDeposito">Valor total do depósito judicial</label>
      <div class="input-prefix-container">
        <span class="input-prefix">R$</span>
        <input type="text" id="valorDeposito" placeholder="0,00" class="has-prefix" inputmode="decimal">
      </div>
      <div id="erroDeposito" class="erro"></div>
    </div>
    
    <div class="campo">
      <label>Tipo de honorários a calcular</label>
      <div class="checkbox-group">
        <div class="checkbox-option" id="optionSucumb">
          <div>
            <input type="checkbox" id="checkSucumb">
            <label for="checkSucumb">Honorários sucumbenciais</label>
          </div>
          <div class="descricao">Calculados mediante regra de três simples sobre o depósito total</div>
          <div class="percentual-input" id="divSucumb">
            <label>Percentual (%)</label>
            <input type="number" id="percSucumb" min="0" max="100" step="0.01" placeholder="0,00">
            <div id="erroSucumb" class="erro"></div>
          </div>
        </div>
        
        <div class="checkbox-option" id="optionContrat">
          <div>
            <input type="checkbox" id="checkContrat">
            <label for="checkContrat">Honorários contratuais</label>
          </div>
          <div class="descricao">Calculados diretamente sobre o valor da condenação</div>
          <div class="percentual-input" id="divContrat">
            <label>Percentual (%)</label>
            <input type="number" id="percContrat" min="0" max="100" step="0.01" placeholder="0,00">
            <div id="erroContrat" class="erro"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="resumo" class="resumo">
      <h3>Resumo dos dados informados</h3>
      <div id="resumoTexto"></div>
    </div>
    
    <button id="btnCalc" disabled>Calcular honorários</button>
    
    <div id="resultado" class="resultado">
      <h2>Resultado do cálculo</h2>
      <div id="cardsResultado" class="cards-container"></div>
      
      <div id="certidaoSection" class="certidao-section">
        <div class="certidao-checkbox">
          <input type="checkbox" id="checkCertidao">
          <label for="checkCertidao">Gerar certidão oficial e/ou minuta de alvará</label>
        </div>
        
        <div id="certidaoCampos" class="certidao-campos">
          <h3> </h3>
          
          <div class="campo">
            <label for="orgaoJudiciario">Órgão judiciário</label>
            <input type="text" id="orgaoJudiciario" placeholder="Ex: 1ª Vara Cível de Teresina/PI">
          </div>
          
          <div class="campo">
            <label for="numeroProcesso">Número do processo</label>
            <input type="text" id="numeroProcesso" placeholder="Ex: 0000000-00.0000.0.00.0000">
          </div>
          
          <div class="campo">
            <label for="idDeposito">ID do depósito judicial</label>
            <input type="text" id="idDeposito" placeholder="Ex: DEP-2024-12345">
          </div>
          
          <div class="campo">
            <label for="contaJudicial">Número da conta judicial</label>
            <input type="text" id="contaJudicial" placeholder="Ex: 00000000-0">
          </div>
          
          <div class="campo">
            <label for="nomeParte">Nome da parte</label>
            <input type="text" id="nomeParte" placeholder="Nome completo">
          </div>
          
          <div class="campo">
            <label for="cpfParte">CPF da parte</label>
            <input type="text" id="cpfParte" placeholder="000.000.000-00">
          </div>
          
          <div class="campo">
            <label for="contaBancariaParte">Conta bancária da parte <span class="campo-opcional">(opcional)</span></label>
            <input type="text" id="contaBancariaParte" placeholder="Informe os dados bancários para transferência">
          </div>
          
          <div class="campo">
            <label for="nomeAdvogado">Nome do(a) advogado(a)</label>
            <input type="text" id="nomeAdvogado" placeholder="Nome completo">
          </div>
          
          <div class="campo">
            <label for="oabAdvogado">OAB</label>
            <input type="text" id="oabAdvogado" placeholder="Ex: 12345/PI">
          </div>
          
          <div class="campo">
            <label for="contaBancariaAdvogado">Conta bancária do(a) advogado(a) <span class="campo-opcional">(opcional)</span></label>
            <input type="text" id="contaBancariaAdvogado" placeholder="Informe os dados bancários para transferência">
          </div>
          
          <div class="campo">
            <label for="idSentenca">ID da sentença/acórdão <span class="campo-opcional">(opcional)</span></label>
            <input type="text" id="idSentenca" placeholder="Ex: Sentença ID 2024-001">
          </div>
          
          <div class="campo">
            <label for="idContrato">ID do contrato de honorários <span class="campo-opcional">(opcional)</span></label>
            <input type="text" id="idContrato" placeholder="Ex: Contrato nº 001/2024">
          </div>
          
          <div class="campo">
            <label for="nomeServidor">Nome do(a) servidor(a) responsável</label>
            <input type="text" id="nomeServidor" placeholder="Nome completo">
          </div>
          
          <div class="campo">
            <label for="cargoServidor">Cargo do(a) servidor(a)</label>
            <input type="text" id="cargoServidor" placeholder="Ex: Analista Judiciário">
          </div>
          
          <div class="campo">
            <label for="dataCertidao">Data da certidão</label>
            <input type="date" id="dataCertidao">
          </div>

          <div style="grid-column: 1 / -1; display: flex; flex-direction: column; gap: var(--space-12); margin-top: var(--space-8);">
              <button id="btnGerarCertidao" disabled>Visualizar certidão</button>
              <button id="btnGerarAlvara" disabled>Visualizar minuta de alvará</button>
          </div>
      </div>
    </div>
  </div>

  <!-- Modal Certidão -->
  <div id="modalCertidao" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Certidão de apuração de honorários</h2>
        <button class="modal-close" onclick="document.getElementById('modalCertidao').classList.remove('ativo')">&times;</button>
      </div>
      <div class="modal-body">
        <div id="certidaoConteudo" class="certidao-preview"></div>
      </div>
      <div class="modal-buttons">
        <button class="btn-secondary" onclick="document.getElementById('modalCertidao').classList.remove('ativo')">Fechar</button>
        <button onclick="imprimirModal('modalCertidao')">Imprimir / Salvar PDF</button>
      </div>
    </div>
  </div>

  <!-- Modal Alvará -->
  <div id="modalAlvara" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Minuta de alvará de liberação</h2>
        <button class="modal-close" onclick="document.getElementById('modalAlvara').classList.remove('ativo')">&times;</button>
      </div>
      <div class="modal-body">
        <textarea id="alvaraTextarea" class="alvara-textarea"></textarea>
      </div>
      <div class="modal-buttons">
        <button class="btn-secondary" onclick="document.getElementById('modalAlvara').classList.remove('ativo')">Fechar</button>
        <button onclick="copiarTextoAlvara()">Copiar texto</button>
      </div>
    </div>
  </div>

  <script>
    const fmt = new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2});
    const fmtPct = new Intl.NumberFormat('pt-BR', {style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2});
    
    let dadosCalculo = null;
    
    const valorDeposito = document.getElementById('valorDeposito');
    const erroDeposito = document.getElementById('erroDeposito');
    const checkSucumb = document.getElementById('checkSucumb');
    const checkContrat = document.getElementById('checkContrat');
    const optionSucumb = document.getElementById('optionSucumb');
    const optionContrat = document.getElementById('optionContrat');
    const divSucumb = document.getElementById('divSucumb');
    const divContrat = document.getElementById('divContrat');
    const percSucumb = document.getElementById('percSucumb');
    const percContrat = document.getElementById('percContrat');
    const erroSucumb = document.getElementById('erroSucumb');
    const erroContrat = document.getElementById('erroContrat');
    const resumo = document.getElementById('resumo');
    const resumoTexto = document.getElementById('resumoTexto');
    const btnCalc = document.getElementById('btnCalc');
    const resultado = document.getElementById('resultado');
    const cardsResultado = document.getElementById('cardsResultado');
    const certidaoSection = document.getElementById('certidaoSection');
    const checkCertidao = document.getElementById('checkCertidao');
    const certidaoCampos = document.getElementById('certidaoCampos');
    const btnGerarCertidao = document.getElementById('btnGerarCertidao');
    const btnGerarAlvara = document.getElementById('btnGerarAlvara');
    const alvaraTextarea = document.getElementById('alvaraTextarea');
    
    // Função para impressão melhorada
    function imprimirModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        // Garantir que o modal está visível para impressão
        modal.classList.add('ativo');
        
        // Pequeno delay para garantir que o DOM esteja atualizado
        setTimeout(() => {
          window.print();
        }, 100);
      }
    }
    
    // Função para copiar o texto do alvará
    function copiarTextoAlvara() {
    const textarea = document.getElementById('alvaraTextarea');
    
    // Seleciona o texto
    textarea.select();
    textarea.setSelectionRange(0, 99999); // Para mobile
    
    try {
        // Tenta copiar usando a API moderna
        navigator.clipboard.writeText(textarea.value).then(() => {
        alert('Texto copiado para a área de transferência!');
        }).catch(err => {
        // Fallback para método antigo
        document.execCommand('copy');
        alert('Texto copiado para a área de transferência!');
        });
    } catch (err) {
        // Último fallback
        alert('Não foi possível copiar o texto automaticamente. Selecione e copie manualmente (Ctrl+C).');
    }
    }

    function getHoje() {
      const h = new Date();
      return h.getFullYear() + '-' + String(h.getMonth()+1).padStart(2,'0') + '-' + String(h.getDate()).padStart(2,'0');
    }
    
    function formatarData(iso) {
      if (!iso) return '';
      const [a, m, d] = iso.split('-');
      return `${d}/${m}/${a}`;
    }
    
    function valorPorExtenso(valor) {
      const unidades = ['', 'um', 'dois', 'três', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
      const especiais = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
      const dezenas = ['', '', 'vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
      const centenas = ['', 'cento', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];
      
      function porExtenso(n) {
        if (n === 0) return 'zero';
        if (n === 100) return 'cem';
        if (n < 10) return unidades[n];
        if (n < 20) return especiais[n - 10];
        if (n < 100) {
          const d = Math.floor(n / 10);
          const u = n % 10;
          return dezenas[d] + (u > 0 ? ' e ' + unidades[u] : '');
        }
        if (n < 1000) {
          const c = Math.floor(n / 100);
          const r = n % 100;
          return centenas[c] + (r > 0 ? ' e ' + porExtenso(r) : '');
        }
        if (n < 1000000) {
          const m = Math.floor(n / 1000);
          const r = n % 1000;
          const milhar = m === 1 ? 'mil' : porExtenso(m) + ' mil';
          return milhar + (r > 0 ? (r < 100 ? ' e ' : ' ') + porExtenso(r) : '');
        }
        return n.toString();
      }
      
      const partes = valor.toFixed(2).split('.');
      const reais = parseInt(partes[0]);
      const centavos = parseInt(partes[1]);
      
      let texto = '';
      if (reais > 0) {
        texto += porExtenso(reais) + (reais === 1 ? ' real' : ' reais');
      }
      if (centavos > 0) {
        if (reais > 0) texto += ' e ';
        texto += porExtenso(centavos) + (centavos === 1 ? ' centavo' : ' centavos');
      }
      if (reais === 0 && centavos === 0) texto = 'zero reais';
      
      return texto;
    }
    
  function getValorNumerico(valorFormatado) {
    if (!valorFormatado) return 0;
    const valorLimpo = String(valorFormatado).replace(/\./g, '').replace(',', '.');
    return parseFloat(valorLimpo) || 0;
  }

  function formatarInputMilhar(input) {
    let valor = input.value.replace(/\D/g, '');
    if (valor === '') {
        input.value = '';
        return;
    }
    valor = (parseInt(valor, 10) / 100).toLocaleString('pt-BR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
    if (valor === 'NaN') {
        input.value = '';
        return;
    }
    input.value = valor;
  }

    checkSucumb.addEventListener('change', () => {
      if (checkSucumb.checked) {
        divSucumb.classList.add('ativo');
        optionSucumb.classList.add('active');
      } else {
        divSucumb.classList.remove('ativo');
        optionSucumb.classList.remove('active');
        percSucumb.value = '';
        erroSucumb.classList.remove('ativo');
      }
      validar();
    });
    
    checkContrat.addEventListener('change', () => {
      if (checkContrat.checked) {
        divContrat.classList.add('ativo');
        optionContrat.classList.add('active');
      } else {
        divContrat.classList.remove('ativo');
        optionContrat.classList.remove('active');
        percContrat.value = '';
        erroContrat.classList.remove('ativo');
      }
      validar();
    });
    
    function validarDeposito() {
        erroDeposito.classList.remove('ativo');
        if (!valorDeposito.value) return false;
        const v = getValorNumerico(valorDeposito.value);
        if (isNaN(v) || v <= 0) {
        erroDeposito.textContent = 'Valor deve ser maior que zero.';
        erroDeposito.classList.add('ativo');
        return false;
      }
      return true;
    }
    
    function validarSucumb() {
      erroSucumb.classList.remove('ativo');
      if (!checkSucumb.checked) return true;
      if (!percSucumb.value) return false;
      const p = parseFloat(percSucumb.value);
      if (isNaN(p) || p < 0 || p > 100) {
        erroSucumb.textContent = 'Percentual deve estar entre 0 e 100.';
        erroSucumb.classList.add('ativo');
        return false;
      }
      return true;
    }
    
    function validarContrat() {
      erroContrat.classList.remove('ativo');
      if (!checkContrat.checked) return true;
      if (!percContrat.value) return false;
      const p = parseFloat(percContrat.value);
      if (isNaN(p) || p < 0 || p > 100) {
        erroContrat.textContent = 'Percentual deve estar entre 0 e 100.';
        erroContrat.classList.add('ativo');
        return false;
      }
      return true;
    }
    
    function validar() {
      const ok1 = validarDeposito();
      const ok2 = validarSucumb();
      const ok3 = validarContrat();
      const ok4 = checkSucumb.checked || checkContrat.checked;
      
      if (ok1 && ok2 && ok3 && ok4) {
        mostrarResumo();
        btnCalc.disabled = false;
      } else {
        resumo.classList.remove('ativo');
        btnCalc.disabled = true;
      }
    }
    
    function mostrarResumo() {
        const deposito = getValorNumerico(valorDeposito.value);
        let html = `<div class="resumo-item"><strong>Valor do depósito:</strong> ${fmt.format(deposito)}</div>`;
       if (checkSucumb.checked) {
        const p = parseFloat(percSucumb.value);
        html += `<div class="resumo-item"><strong>Honorários sucumbenciais:</strong> ${p.toFixed(2)}%</div>`;
        }
      
       if (checkContrat.checked) {
        const p = parseFloat(percContrat.value);
        html += `<div class="resumo-item"><strong>Honorários contratuais:</strong> ${p.toFixed(2)}%</div>`;
        }
      
      resumoTexto.innerHTML = html;
      resumo.classList.add('ativo');
    }
    
    btnCalc.addEventListener('click', () => {
      const deposito = getValorNumerico(valorDeposito.value);
      let condenacao = deposito;
      let honSucumb = 0;
      let honContrat = 0;
      
      // Calcular honorários sucumbenciais (regra de 3)
      if (checkSucumb.checked) {
        const pSucumb = parseFloat(percSucumb.value) / 100;
        condenacao = deposito / (1 + pSucumb);
        honSucumb = deposito - condenacao;
      }
      
      // Calcular honorários contratuais (sobre condenação)
      if (checkContrat.checked) {
        const pContrat = parseFloat(percContrat.value) / 100;
        honContrat = condenacao * pContrat;
      }
      
      const totalHon = honSucumb + honContrat;
      const valorParte = condenacao - honContrat;
      
      // Salvar dados para certidão
      dadosCalculo = {
        deposito,
        condenacao,
        honSucumb,
        honContrat,
        totalHon,
        valorParte,
        percSucumb: checkSucumb.checked ? parseFloat(percSucumb.value) : 0,
        percContrat: checkContrat.checked ? parseFloat(percContrat.value) : 0,
        temSucumb: checkSucumb.checked,
        temContrat: checkContrat.checked
      };
      
      let detalhes = [];
      detalhes.push(`<div class="card-detalhe"><strong>Valor do depósito:</strong> ${fmt.format(deposito)}</div>`);
      detalhes.push(`<div class="card-detalhe"><strong>Valor da condenação:</strong> ${fmt.format(condenacao)}</div>`);
      
      if (checkSucumb.checked) {
        detalhes.push(`<div class="card-detalhe"><strong>Honorários sucumbenciais (${dadosCalculo.percSucumb.toFixed(2)}%):</strong> ${fmt.format(honSucumb)}</div>`);
      }
      
      if (checkContrat.checked) {
        detalhes.push(`<div class="card-detalhe"><strong>Honorários contratuais (${dadosCalculo.percContrat.toFixed(2)}%):</strong> ${fmt.format(honContrat)}</div>`);
      }
      
      detalhes.push(`<div class="card-detalhe"><strong>Total de honorários:</strong> ${fmt.format(totalHon)}</div>`);
      detalhes.push(`<div class="card-detalhe"><strong>Valor destinado à parte:</strong> ${fmt.format(valorParte)}</div>`);
      
      let html = `<div class="card card-total" style="padding-top: 20px; padding-bottom: 20px;">
        ${detalhes.join('')}
      </div>`;
      
      cardsResultado.innerHTML = html;
      resultado.classList.add('ativo');
      certidaoSection.classList.add('ativo');
      resultado.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
    
    checkCertidao.addEventListener('change', () => {
      if (checkCertidao.checked) {
        certidaoCampos.classList.add('ativo');
        document.getElementById('dataCertidao').value = getHoje();
      } else {
        certidaoCampos.classList.remove('ativo');
      }
      validarCertidao();
    });
    
    function validarCertidao() {
      if (!checkCertidao.checked) {
        btnGerarCertidao.disabled = true;
        btnGerarAlvara.disabled = true;
        return;
      }
      
      const campos = [
        document.getElementById('orgaoJudiciario'),
        document.getElementById('numeroProcesso'),
        document.getElementById('idDeposito'),
        document.getElementById('contaJudicial'),
        document.getElementById('nomeParte'),
        document.getElementById('cpfParte'),
        document.getElementById('nomeAdvogado'),
        document.getElementById('oabAdvogado'),
        document.getElementById('nomeServidor'),
        document.getElementById('cargoServidor'),
        document.getElementById('dataCertidao')
      ];
      
      const todosPreenchidos = campos.every(c => c.value.trim() !== '');
      btnGerarCertidao.disabled = !todosPreenchidos;
      btnGerarAlvara.disabled = !todosPreenchidos;
    }
    
    [
      'orgaoJudiciario', 'numeroProcesso', 'idDeposito', 'contaJudicial',
      'nomeParte', 'cpfParte', 'nomeAdvogado', 'oabAdvogado',
      'nomeServidor', 'cargoServidor', 'dataCertidao'
    ].forEach(id => {
      document.getElementById(id).addEventListener('input', validarCertidao);
    });
    
    btnGerarCertidao.addEventListener('click', () => {
      const d = dadosCalculo;
      const orgao = document.getElementById('orgaoJudiciario').value;
      const processo = document.getElementById('numeroProcesso').value;
      const idDep = document.getElementById('idDeposito').value;
      const conta = document.getElementById('contaJudicial').value;
      const parte = document.getElementById('nomeParte').value;
      const cpf = document.getElementById('cpfParte').value;
      const advogado = document.getElementById('nomeAdvogado').value;
      const oab = document.getElementById('oabAdvogado').value;
      const sentenca = document.getElementById('idSentenca').value;
      const contrato = document.getElementById('idContrato').value;
      const servidor = document.getElementById('nomeServidor').value;
      const cargo = document.getElementById('cargoServidor').value;
      const data = document.getElementById('dataCertidao').value;
      
      let html = `<div class="orgao">${orgao}</div>`;
      html += `<div class="titulo">CERTIDÃO DE APURAÇÃO DE HONORÁRIOS ADVOCATÍCIOS</div>`;
      html += `<div class="corpo">Certifico, para os devidos fins, que nos autos do processo nº <strong>${processo}</strong>, foi realizada a apuração de honorários advocatícios incidentes sobre o depósito judicial ID <strong>${idDep}</strong>, vinculado à conta judicial nº <strong>${conta}</strong>, conforme discriminação a seguir:</div>`;
      
      html += `<table>`;
      html += `<tr><th>Descrição</th><th>Valor (R$)</th></tr>`;
      html += `<tr><td>Valor total do depósito judicial</td><td>${fmt.format(d.deposito)}</td></tr>`;
      html += `<tr><td>Valor da condenação</td><td>${fmt.format(d.condenacao)}</td></tr>`;
      
      if (d.temSucumb) {
        html += `<tr><td>Honorários sucumbenciais (${d.percSucumb.toFixed(2)}%)`;
        if (sentenca) html += `<br><small>${sentenca}</small>`;
        html += `</td><td>${fmt.format(d.honSucumb)}</td></tr>`;
      }
      
      if (d.temContrat) {
        html += `<tr><td>Honorários contratuais (${d.percContrat.toFixed(2)}%)`;
        if (contrato) html += `<br><small>${contrato}</small>`;
        html += `</td><td>${fmt.format(d.honContrat)}</td></tr>`;
      }
      
      html += `<tr><td><strong>Total de honorários</strong></td><td><strong>${fmt.format(d.totalHon)}</strong></td></tr>`;
      html += `<tr><td><strong>Valor destinado à parte</strong></td><td><strong>${fmt.format(d.valorParte)}</strong></td></tr>`;
      html += `</table>`;
      
      html += `<div class="corpo"><strong>Beneficiários:</strong></div>`;
      html += `<div class="corpo">• Advogado(a): <strong>${advogado}</strong>, OAB/${oab} - Valor: <strong>${fmt.format(d.totalHon)}</strong> (${valorPorExtenso(d.totalHon)})</div>`;
      html += `<div class="corpo">• Parte: <strong>${parte}</strong>, CPF ${cpf} - Valor: <strong>${fmt.format(d.valorParte)}</strong> (${valorPorExtenso(d.valorParte)})</div>`;
      
      html += `<div class="corpo" style="margin-top:30px;">A presente certidão foi emitida na comarca acima indicada, em ${formatarData(data)}.</div>`;
      
      html += `<div class="assinatura">`;
      html += `<div class="assinatura-linha"></div>`;
      html += `<div><strong>${servidor}</strong></div>`;
      html += `<div><strong>${cargo}</strong></div>`;
      html += `</div>`;
      
      document.getElementById('certidaoConteudo').innerHTML = html;
      document.getElementById('modalCertidao').classList.add('ativo');
    });
    
    btnGerarAlvara.addEventListener('click', () => {
      const d = dadosCalculo;
      const orgao = document.getElementById('orgaoJudiciario').value;
      const processo = document.getElementById('numeroProcesso').value;
      const idDep = document.getElementById('idDeposito').value;
      const conta = document.getElementById('contaJudicial').value;
      const parte = document.getElementById('nomeParte').value;
      const cpf = document.getElementById('cpfParte').value;
      const advogado = document.getElementById('nomeAdvogado').value;
      const oab = document.getElementById('oabAdvogado').value;
      const contaAdvogado = document.getElementById('contaBancariaAdvogado').value;
      const contaParte = document.getElementById('contaBancariaParte').value;
      const data = document.getElementById('dataCertidao').value;
      
      let tipoHon = '';
      if (d.temSucumb && d.temContrat) tipoHon = 'honorários sucumbenciais e contratuais';
      else if (d.temSucumb) tipoHon = 'honorários sucumbenciais';
      else if (d.temContrat) tipoHon = 'honorários contratuais';
      
      let texto = `Por meio do presente alvará o MM. Juiz da ${orgao} autoriza a liberação de recursos mantidos na conta judicial nº ${conta}, vinculada ao depósito judicial ID ${idDep}, nos autos do processo nº ${processo}, com os devidos acréscimos legais, da seguinte forma:\n\n`;
      
      texto += `a) ${fmt.format(d.totalHon)} (${valorPorExtenso(d.totalHon)}), referente a ${tipoHon}, em favor de ${advogado}, OAB/${oab}`;
      if (contaAdvogado) {
        texto += `, a serem transferidos para a conta bancária: ${contaAdvogado}`;
      }
      texto += `;\n\n`;
      
      texto += `b) ${fmt.format(d.valorParte)} (${valorPorExtenso(d.valorParte)}), correspondente ao saldo remanescente da condenação, em favor de ${parte}, CPF ${cpf}`;
      if (contaParte) {
        texto += `, a serem transferidos para a conta bancária: ${contaParte}`;
      }
      texto += `.\n\n`;
      
      texto += `${formatarData(data)}.`;
      
      // Preencher a textarea com o texto gerado
      alvaraTextarea.value = texto;
      document.getElementById('modalAlvara').classList.add('ativo');
    });
    
    valorDeposito.addEventListener('input', () => {
        formatarInputMilhar(valorDeposito);
        validar();
    });
    percSucumb.addEventListener('input', validar);
    percContrat.addEventListener('input', validar);

  </script>
</body>
</html>
